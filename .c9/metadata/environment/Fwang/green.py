{"changed":true,"filter":false,"title":"green.py","tooltip":"/Fwang/green.py","value":"'''\nThis is an example bot that trades a single instrument C2_GREEN_ENERGY_ETF.\nAll it does is to randomly insert either a BID or an ASK every 5 seconds.\nThe price at which it inserts is equal to the opposite side of the order book.\nThus, if the best bid in the order book is currently 90, it will send a sell order for price 90.\nIf the best ask in the order book is 91, it will send a buy order for price 91.\n\nThe order type this bot uses is IOC (immediate or cancel). This means that if the order does not\nimmediately trade, it will not be visible to others in the order book. Instead, it will be cancelled automatically.\n'''\nimport logging\nimport time\nfrom typing import List\nfrom optibook import common_types as t\nfrom optibook import ORDER_TYPE_IOC, ORDER_TYPE_LIMIT, SIDE_ASK, SIDE_BID\nfrom optibook.exchange_responses import InsertOrderResponse\nfrom optibook.synchronous_client import Exchange\nimport random\nimport json\n\nlogging.getLogger('client').setLevel('ERROR')\nlogger = logging.getLogger(__name__)\n\nBASKET_INSTRUMENT_ID = 'C2_GREEN_ENERGY_ETF'\nSTOCK_INSTRUMENT_IDS = ['C2_SOLAR_CO', 'C2_WIND_LTD']\n\ne = Exchange()\ne.connect()\n\ndef print_report(e: Exchange):\n    pnl = e.get_pnl()\n    positions = e.get_positions_and_cash()\n    my_trades = e.poll_new_trades(BASKET_INSTRUMENT_ID)\n    all_market_trades = e.poll_new_trade_ticks(BASKET_INSTRUMENT_ID)\n    logger.info(f'I have done {len(my_trades)} trade(s) in {BASKET_INSTRUMENT_ID} since the last report. There have been {len(all_market_trades)} market trade(s) in total in {BASKET_INSTRUMENT_ID} since the last report.')\n    logger.info(f'My PNL is: {pnl:.2f}')\n    logger.info(f'My current positions are: {json.dumps(positions, indent=3)}')\n\n\ndef print_order_response(order_response: InsertOrderResponse):\n    if order_response.success:\n        logger.info(f\"Inserted order successfully, order_id='{order_response.order_id}'\")\n    else:\n        logger.info(f\"Unable to insert order with reason: '{order_response.success}'\")\n\n#def get_cash_delta\n\ndef trade_cycle(e: Exchange, vol: int,bought_prc: int,sell_prc: int):\n    basket_book = e.get_last_price_book(BASKET_INSTRUMENT_ID)\n    if basket_book and basket_book.bids and basket_book.asks:\n        \n        new_bid = basket_book.bids[0].price + 0.1\n        new_ask = basket_book.asks[0].price - 0.1\n        bought_prc = new_bid*vol*2\n        sell_prc = new_ask*vol*2\n        \n        if bought_prc < sell_prc:\n            e.insert_order(BASKET_INSTRUMENT_ID, price=new_ask, volume=vol*2, side=SIDE_ASK, order_type=ORDER_TYPE_IOC)\n            e.insert_order(STOCK_INSTRUMENT_IDS[0], price=new_bid, volume=vol, side=SIDE_BID, order_type=ORDER_TYPE_IOC)\n            e.insert_order(STOCK_INSTRUMENT_IDS[1], price=new_bid, volume=vol, side=SIDE_BID, order_type=ORDER_TYPE_IOC)\n        \n    else:\n        logger.info('No top bid/ask or no book at all for the basket instrument')\n\n    print_report(e)\n    \ndef closeAllPosition(debug=False):\n    '''\n    Iterates and attempts to close all open positions\n    \n    Parameters\n    -----------\n    debug : Bool\n        If true, we print our current positions before and after attempting\n        to close\n    '''\n    if(debug):\n        print(\"Starting Positions: \")\n        print(e.get_positions())\n    for s, p in e.get_positions().items():\n        if p > 0:\n            e.insert_order(s, price=1, volume=p, side='ask', order_type='ioc')\n        elif p < 0:\n            e.insert_order(s, price=100000, volume=-p, side='bid', order_type='ioc')  \n    if(debug):\n        print(\"End Positions: \")\n        print(e.get_positions())\n\ndef main():\n\n    basket_book = e.get_last_price_book(BASKET_INSTRUMENT_ID)\n    vol=2\n    bought_prc = -1\n    sell_prc = -1\n    #closeAllPosition()\n    \n    new_bid = basket_book.bids[0].price + 0.1\n    response: InsertOrderResponse = e.insert_order(STOCK_INSTRUMENT_IDS[0], price=new_bid, volume=vol, side=SIDE_BID, order_type=ORDER_TYPE_IOC)\n    response: InsertOrderResponse = e.insert_order(STOCK_INSTRUMENT_IDS[1], price=new_bid, volume=vol, side=SIDE_BID, order_type=ORDER_TYPE_IOC)\n    \n\n    # you can also define host/user/pass yourself\n    # when not defined, it is taken from ~/.optibook file if it exists\n    # if that file does not exists, an error is thrown\n    #exchange = Exchange(host='host-to-connect-to', info_port=7001, exec_port=8001, username='your-username', password='your-password')\n    #exchange.connect()\n    \n    sleep_duration_sec = 1\n    while True:\n        \n        logger.info(f'Iteration complete. Sleeping for {sleep_duration_sec} seconds')\n        time.sleep(sleep_duration_sec)\n\n\nif __name__ == '__main__':\n    main()","undoManager":{"mark":-5,"position":100,"stack":[[{"start":{"row":49,"column":4},"end":{"row":49,"column":8},"action":"remove","lines":["    "],"id":674},{"start":{"row":49,"column":0},"end":{"row":49,"column":4},"action":"remove","lines":["    "]},{"start":{"row":48,"column":49},"end":{"row":49,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":56,"column":8},"end":{"row":56,"column":9},"action":"insert","lines":["e"],"id":675},{"start":{"row":56,"column":9},"end":{"row":56,"column":10},"action":"insert","lines":["l"]},{"start":{"row":56,"column":10},"end":{"row":56,"column":11},"action":"insert","lines":["s"]},{"start":{"row":56,"column":11},"end":{"row":56,"column":12},"action":"insert","lines":["e"]}],[{"start":{"row":56,"column":12},"end":{"row":56,"column":13},"action":"insert","lines":[" "],"id":676}],[{"start":{"row":56,"column":12},"end":{"row":56,"column":13},"action":"remove","lines":[" "],"id":677},{"start":{"row":56,"column":11},"end":{"row":56,"column":12},"action":"remove","lines":["e"]},{"start":{"row":56,"column":10},"end":{"row":56,"column":11},"action":"remove","lines":["s"]}],[{"start":{"row":56,"column":10},"end":{"row":56,"column":11},"action":"insert","lines":["o"],"id":678},{"start":{"row":56,"column":11},"end":{"row":56,"column":12},"action":"insert","lines":["f"]}],[{"start":{"row":56,"column":11},"end":{"row":56,"column":12},"action":"remove","lines":["f"],"id":679},{"start":{"row":56,"column":10},"end":{"row":56,"column":11},"action":"remove","lines":["o"]}],[{"start":{"row":56,"column":10},"end":{"row":56,"column":11},"action":"insert","lines":["i"],"id":680},{"start":{"row":56,"column":11},"end":{"row":56,"column":12},"action":"insert","lines":["o"]},{"start":{"row":56,"column":12},"end":{"row":56,"column":13},"action":"insert","lines":["f"]}],[{"start":{"row":56,"column":13},"end":{"row":56,"column":14},"action":"insert","lines":[" "],"id":681}],[{"start":{"row":56,"column":13},"end":{"row":56,"column":14},"action":"remove","lines":[" "],"id":682},{"start":{"row":56,"column":12},"end":{"row":56,"column":13},"action":"remove","lines":["f"]},{"start":{"row":56,"column":11},"end":{"row":56,"column":12},"action":"remove","lines":["o"]}],[{"start":{"row":56,"column":11},"end":{"row":56,"column":12},"action":"insert","lines":["f"],"id":683}],[{"start":{"row":56,"column":12},"end":{"row":56,"column":13},"action":"insert","lines":[" "],"id":684}],[{"start":{"row":56,"column":13},"end":{"row":56,"column":32},"action":"insert","lines":["InsertOrderResponse"],"id":685}],[{"start":{"row":56,"column":32},"end":{"row":56,"column":33},"action":"insert","lines":["."],"id":686},{"start":{"row":56,"column":33},"end":{"row":56,"column":34},"action":"insert","lines":["s"]}],[{"start":{"row":56,"column":33},"end":{"row":56,"column":34},"action":"remove","lines":["s"],"id":687}],[{"start":{"row":56,"column":32},"end":{"row":56,"column":33},"action":"remove","lines":["."],"id":688},{"start":{"row":56,"column":31},"end":{"row":56,"column":32},"action":"remove","lines":["e"]},{"start":{"row":56,"column":30},"end":{"row":56,"column":31},"action":"remove","lines":["s"]},{"start":{"row":56,"column":29},"end":{"row":56,"column":30},"action":"remove","lines":["n"]},{"start":{"row":56,"column":28},"end":{"row":56,"column":29},"action":"remove","lines":["o"]},{"start":{"row":56,"column":27},"end":{"row":56,"column":28},"action":"remove","lines":["p"]},{"start":{"row":56,"column":26},"end":{"row":56,"column":27},"action":"remove","lines":["s"]},{"start":{"row":56,"column":25},"end":{"row":56,"column":26},"action":"remove","lines":["e"]},{"start":{"row":56,"column":24},"end":{"row":56,"column":25},"action":"remove","lines":["R"]},{"start":{"row":56,"column":23},"end":{"row":56,"column":24},"action":"remove","lines":["r"]},{"start":{"row":56,"column":22},"end":{"row":56,"column":23},"action":"remove","lines":["e"]},{"start":{"row":56,"column":21},"end":{"row":56,"column":22},"action":"remove","lines":["d"]},{"start":{"row":56,"column":20},"end":{"row":56,"column":21},"action":"remove","lines":["r"]},{"start":{"row":56,"column":19},"end":{"row":56,"column":20},"action":"remove","lines":["O"]},{"start":{"row":56,"column":18},"end":{"row":56,"column":19},"action":"remove","lines":["t"]},{"start":{"row":56,"column":17},"end":{"row":56,"column":18},"action":"remove","lines":["r"]},{"start":{"row":56,"column":16},"end":{"row":56,"column":17},"action":"remove","lines":["e"]},{"start":{"row":56,"column":15},"end":{"row":56,"column":16},"action":"remove","lines":["s"]},{"start":{"row":56,"column":14},"end":{"row":56,"column":15},"action":"remove","lines":["n"]},{"start":{"row":56,"column":13},"end":{"row":56,"column":14},"action":"remove","lines":["I"]},{"start":{"row":56,"column":12},"end":{"row":56,"column":13},"action":"remove","lines":[" "]},{"start":{"row":56,"column":11},"end":{"row":56,"column":12},"action":"remove","lines":["f"]},{"start":{"row":56,"column":10},"end":{"row":56,"column":11},"action":"remove","lines":["i"]},{"start":{"row":56,"column":9},"end":{"row":56,"column":10},"action":"remove","lines":["l"]},{"start":{"row":56,"column":8},"end":{"row":56,"column":9},"action":"remove","lines":["e"]},{"start":{"row":56,"column":4},"end":{"row":56,"column":8},"action":"remove","lines":["    "]}],[{"start":{"row":56,"column":0},"end":{"row":56,"column":4},"action":"remove","lines":["    "],"id":689},{"start":{"row":55,"column":8},"end":{"row":56,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":55,"column":8},"end":{"row":56,"column":0},"action":"insert","lines":["",""],"id":690},{"start":{"row":56,"column":0},"end":{"row":56,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":56,"column":4},"end":{"row":56,"column":8},"action":"remove","lines":["    "],"id":691},{"start":{"row":56,"column":0},"end":{"row":56,"column":4},"action":"remove","lines":["    "]},{"start":{"row":55,"column":8},"end":{"row":56,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":55,"column":8},"end":{"row":55,"column":9},"action":"insert","lines":["s"],"id":692},{"start":{"row":55,"column":9},"end":{"row":55,"column":10},"action":"insert","lines":["e"]},{"start":{"row":55,"column":10},"end":{"row":55,"column":11},"action":"insert","lines":["l"]},{"start":{"row":55,"column":11},"end":{"row":55,"column":12},"action":"insert","lines":["s"]},{"start":{"row":55,"column":12},"end":{"row":55,"column":13},"action":"insert","lines":["e"]}],[{"start":{"row":55,"column":13},"end":{"row":55,"column":14},"action":"insert","lines":[" "],"id":693}],[{"start":{"row":55,"column":13},"end":{"row":55,"column":14},"action":"remove","lines":[" "],"id":694},{"start":{"row":55,"column":12},"end":{"row":55,"column":13},"action":"remove","lines":["e"]},{"start":{"row":55,"column":11},"end":{"row":55,"column":12},"action":"remove","lines":["s"]},{"start":{"row":55,"column":10},"end":{"row":55,"column":11},"action":"remove","lines":["l"]},{"start":{"row":55,"column":9},"end":{"row":55,"column":10},"action":"remove","lines":["e"]},{"start":{"row":55,"column":8},"end":{"row":55,"column":9},"action":"remove","lines":["s"]}],[{"start":{"row":55,"column":8},"end":{"row":55,"column":9},"action":"insert","lines":["i"],"id":695},{"start":{"row":55,"column":9},"end":{"row":55,"column":10},"action":"insert","lines":["o"]}],[{"start":{"row":55,"column":9},"end":{"row":55,"column":10},"action":"remove","lines":["o"],"id":696},{"start":{"row":55,"column":8},"end":{"row":55,"column":9},"action":"remove","lines":["i"]}],[{"start":{"row":55,"column":8},"end":{"row":55,"column":9},"action":"insert","lines":["e"],"id":697},{"start":{"row":55,"column":9},"end":{"row":55,"column":10},"action":"insert","lines":["l"]},{"start":{"row":55,"column":10},"end":{"row":55,"column":11},"action":"insert","lines":["i"]},{"start":{"row":55,"column":11},"end":{"row":55,"column":12},"action":"insert","lines":["f"]}],[{"start":{"row":55,"column":11},"end":{"row":55,"column":12},"action":"remove","lines":["f"],"id":698},{"start":{"row":55,"column":10},"end":{"row":55,"column":11},"action":"remove","lines":["i"]}],[{"start":{"row":55,"column":10},"end":{"row":55,"column":11},"action":"insert","lines":["s"],"id":699},{"start":{"row":55,"column":11},"end":{"row":55,"column":12},"action":"insert","lines":["e"]}],[{"start":{"row":55,"column":12},"end":{"row":55,"column":13},"action":"insert","lines":[" "],"id":700}],[{"start":{"row":55,"column":12},"end":{"row":55,"column":13},"action":"remove","lines":[" "],"id":701},{"start":{"row":55,"column":11},"end":{"row":55,"column":12},"action":"remove","lines":["e"]},{"start":{"row":55,"column":10},"end":{"row":55,"column":11},"action":"remove","lines":["s"]},{"start":{"row":55,"column":9},"end":{"row":55,"column":10},"action":"remove","lines":["l"]},{"start":{"row":55,"column":8},"end":{"row":55,"column":9},"action":"remove","lines":["e"]}],[{"start":{"row":55,"column":8},"end":{"row":55,"column":9},"action":"insert","lines":["i"],"id":702},{"start":{"row":55,"column":9},"end":{"row":55,"column":10},"action":"insert","lines":["f"]}],[{"start":{"row":55,"column":10},"end":{"row":55,"column":11},"action":"insert","lines":[" "],"id":703}],[{"start":{"row":55,"column":11},"end":{"row":55,"column":30},"action":"insert","lines":["InsertOrderResponse"],"id":704}],[{"start":{"row":55,"column":30},"end":{"row":55,"column":31},"action":"insert","lines":["."],"id":705}],[{"start":{"row":55,"column":31},"end":{"row":55,"column":32},"action":"insert","lines":["s"],"id":706},{"start":{"row":55,"column":32},"end":{"row":55,"column":33},"action":"insert","lines":["u"]},{"start":{"row":55,"column":33},"end":{"row":55,"column":34},"action":"insert","lines":["c"]},{"start":{"row":55,"column":34},"end":{"row":55,"column":35},"action":"insert","lines":["c"]},{"start":{"row":55,"column":35},"end":{"row":55,"column":36},"action":"insert","lines":["w"]},{"start":{"row":55,"column":36},"end":{"row":55,"column":37},"action":"insert","lines":["e"]}],[{"start":{"row":55,"column":36},"end":{"row":55,"column":37},"action":"remove","lines":["e"],"id":707},{"start":{"row":55,"column":35},"end":{"row":55,"column":36},"action":"remove","lines":["w"]}],[{"start":{"row":55,"column":35},"end":{"row":55,"column":36},"action":"insert","lines":["e"],"id":708},{"start":{"row":55,"column":36},"end":{"row":55,"column":37},"action":"insert","lines":["s"]},{"start":{"row":55,"column":37},"end":{"row":55,"column":38},"action":"insert","lines":["e"]}],[{"start":{"row":55,"column":37},"end":{"row":55,"column":38},"action":"remove","lines":["e"],"id":709}],[{"start":{"row":55,"column":37},"end":{"row":55,"column":38},"action":"insert","lines":["s"],"id":710}],[{"start":{"row":55,"column":38},"end":{"row":55,"column":39},"action":"insert","lines":[":"],"id":711}],[{"start":{"row":56,"column":8},"end":{"row":56,"column":12},"action":"insert","lines":["    "],"id":712}],[{"start":{"row":57,"column":8},"end":{"row":57,"column":12},"action":"insert","lines":["    "],"id":713}],[{"start":{"row":55,"column":11},"end":{"row":55,"column":23},"action":"remove","lines":["InsertOrderR"],"id":714},{"start":{"row":55,"column":11},"end":{"row":55,"column":12},"action":"insert","lines":["r"]}],[{"start":{"row":45,"column":80},"end":{"row":45,"column":81},"action":"remove","lines":["1"],"id":715},{"start":{"row":45,"column":79},"end":{"row":45,"column":80},"action":"remove","lines":["-"]},{"start":{"row":45,"column":78},"end":{"row":45,"column":79},"action":"remove","lines":[" "]},{"start":{"row":45,"column":77},"end":{"row":45,"column":78},"action":"remove","lines":["="]},{"start":{"row":45,"column":76},"end":{"row":45,"column":77},"action":"remove","lines":["!"]},{"start":{"row":45,"column":75},"end":{"row":45,"column":76},"action":"remove","lines":[" "]},{"start":{"row":45,"column":74},"end":{"row":45,"column":75},"action":"remove","lines":["c"]},{"start":{"row":45,"column":73},"end":{"row":45,"column":74},"action":"remove","lines":["r"]},{"start":{"row":45,"column":72},"end":{"row":45,"column":73},"action":"remove","lines":["p"]}],[{"start":{"row":45,"column":71},"end":{"row":45,"column":72},"action":"remove","lines":["_"],"id":716},{"start":{"row":45,"column":70},"end":{"row":45,"column":71},"action":"remove","lines":["t"]},{"start":{"row":45,"column":69},"end":{"row":45,"column":70},"action":"remove","lines":["h"]},{"start":{"row":45,"column":68},"end":{"row":45,"column":69},"action":"remove","lines":["g"]},{"start":{"row":45,"column":67},"end":{"row":45,"column":68},"action":"remove","lines":["u"]},{"start":{"row":45,"column":66},"end":{"row":45,"column":67},"action":"remove","lines":["o"]}],[{"start":{"row":45,"column":65},"end":{"row":45,"column":66},"action":"remove","lines":["b"],"id":717},{"start":{"row":45,"column":64},"end":{"row":45,"column":65},"action":"remove","lines":[" "]},{"start":{"row":45,"column":63},"end":{"row":45,"column":64},"action":"remove","lines":["d"]},{"start":{"row":45,"column":62},"end":{"row":45,"column":63},"action":"remove","lines":["n"]},{"start":{"row":45,"column":61},"end":{"row":45,"column":62},"action":"remove","lines":["a"]}],[{"start":{"row":45,"column":60},"end":{"row":45,"column":61},"action":"remove","lines":[" "],"id":718}],[{"start":{"row":46,"column":8},"end":{"row":46,"column":65},"action":"remove","lines":["basket_book = e.get_last_price_book(BASKET_INSTRUMENT_ID)"],"id":719}],[{"start":{"row":44,"column":69},"end":{"row":45,"column":0},"action":"insert","lines":["",""],"id":720},{"start":{"row":45,"column":0},"end":{"row":45,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":45,"column":4},"end":{"row":45,"column":61},"action":"insert","lines":["basket_book = e.get_last_price_book(BASKET_INSTRUMENT_ID)"],"id":721}],[{"start":{"row":53,"column":8},"end":{"row":53,"column":9},"action":"insert","lines":["i"],"id":722},{"start":{"row":53,"column":9},"end":{"row":53,"column":10},"action":"insert","lines":["f"]},{"start":{"row":53,"column":10},"end":{"row":53,"column":11},"action":"insert","lines":["f"]}],[{"start":{"row":53,"column":10},"end":{"row":53,"column":11},"action":"remove","lines":["f"],"id":723}],[{"start":{"row":53,"column":10},"end":{"row":53,"column":11},"action":"insert","lines":[" "],"id":724},{"start":{"row":53,"column":11},"end":{"row":53,"column":12},"action":"insert","lines":["b"]}],[{"start":{"row":53,"column":12},"end":{"row":53,"column":13},"action":"insert","lines":["o"],"id":725},{"start":{"row":53,"column":13},"end":{"row":53,"column":14},"action":"insert","lines":["u"]},{"start":{"row":53,"column":14},"end":{"row":53,"column":15},"action":"insert","lines":["g"]},{"start":{"row":53,"column":15},"end":{"row":53,"column":16},"action":"insert","lines":["j"]}],[{"start":{"row":53,"column":15},"end":{"row":53,"column":16},"action":"remove","lines":["j"],"id":726}],[{"start":{"row":53,"column":15},"end":{"row":53,"column":16},"action":"insert","lines":["h"],"id":727},{"start":{"row":53,"column":16},"end":{"row":53,"column":17},"action":"insert","lines":["t"]}],[{"start":{"row":53,"column":16},"end":{"row":53,"column":17},"action":"remove","lines":["t"],"id":728},{"start":{"row":53,"column":15},"end":{"row":53,"column":16},"action":"remove","lines":["h"]},{"start":{"row":53,"column":14},"end":{"row":53,"column":15},"action":"remove","lines":["g"]},{"start":{"row":53,"column":13},"end":{"row":53,"column":14},"action":"remove","lines":["u"]},{"start":{"row":53,"column":12},"end":{"row":53,"column":13},"action":"remove","lines":["o"]},{"start":{"row":53,"column":11},"end":{"row":53,"column":12},"action":"remove","lines":["b"]},{"start":{"row":53,"column":10},"end":{"row":53,"column":11},"action":"remove","lines":[" "]},{"start":{"row":53,"column":9},"end":{"row":53,"column":10},"action":"remove","lines":["f"]},{"start":{"row":53,"column":8},"end":{"row":53,"column":9},"action":"remove","lines":["i"]},{"start":{"row":53,"column":4},"end":{"row":53,"column":8},"action":"remove","lines":["    "]}],[{"start":{"row":53,"column":0},"end":{"row":53,"column":4},"action":"remove","lines":["    "],"id":729},{"start":{"row":52,"column":8},"end":{"row":53,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":52,"column":4},"end":{"row":52,"column":8},"action":"remove","lines":["    "],"id":730},{"start":{"row":52,"column":0},"end":{"row":52,"column":4},"action":"remove","lines":["    "]},{"start":{"row":51,"column":32},"end":{"row":52,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":51,"column":32},"end":{"row":52,"column":0},"action":"insert","lines":["",""],"id":731},{"start":{"row":52,"column":0},"end":{"row":52,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":80,"column":23},"end":{"row":81,"column":0},"action":"remove","lines":["",""],"id":732}],[{"start":{"row":80,"column":23},"end":{"row":81,"column":0},"action":"insert","lines":["",""],"id":733},{"start":{"row":81,"column":0},"end":{"row":81,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":63,"column":0},"end":{"row":83,"column":32},"action":"insert","lines":["def closeAllPosition(debug=False):","    '''","    Iterates and attempts to close all open positions","    ","    Parameters","    -----------","    debug : Bool","        If true, we print our current positions before and after attempting","        to close","    '''","    if(debug):","        print(\"Starting Positions: \")","        print(e.get_positions())","    for s, p in e.get_positions().items():","        if p > 0:","            e.insert_order(s, price=1, volume=p, side='ask', order_type='ioc')","        elif p < 0:","            e.insert_order(s, price=100000, volume=-p, side='bid', order_type='ioc')  ","    if(debug):","        print(\"End Positions: \")","        print(e.get_positions())"],"id":734}],[{"start":{"row":62,"column":19},"end":{"row":63,"column":0},"action":"insert","lines":["",""],"id":735},{"start":{"row":63,"column":0},"end":{"row":63,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":93,"column":4},"end":{"row":93,"column":5},"action":"insert","lines":["c"],"id":736},{"start":{"row":93,"column":5},"end":{"row":93,"column":6},"action":"insert","lines":["l"]},{"start":{"row":93,"column":6},"end":{"row":93,"column":7},"action":"insert","lines":["o"]},{"start":{"row":93,"column":7},"end":{"row":93,"column":8},"action":"insert","lines":["a"]},{"start":{"row":93,"column":8},"end":{"row":93,"column":9},"action":"insert","lines":["s"]}],[{"start":{"row":93,"column":8},"end":{"row":93,"column":9},"action":"remove","lines":["s"],"id":737},{"start":{"row":93,"column":7},"end":{"row":93,"column":8},"action":"remove","lines":["a"]},{"start":{"row":93,"column":6},"end":{"row":93,"column":7},"action":"remove","lines":["o"]}],[{"start":{"row":93,"column":6},"end":{"row":93,"column":7},"action":"insert","lines":["o"],"id":738},{"start":{"row":93,"column":7},"end":{"row":93,"column":8},"action":"insert","lines":["a"]},{"start":{"row":93,"column":8},"end":{"row":93,"column":9},"action":"insert","lines":["s"]},{"start":{"row":93,"column":9},"end":{"row":93,"column":10},"action":"insert","lines":["e"]}],[{"start":{"row":93,"column":9},"end":{"row":93,"column":10},"action":"remove","lines":["e"],"id":739},{"start":{"row":93,"column":8},"end":{"row":93,"column":9},"action":"remove","lines":["s"]},{"start":{"row":93,"column":7},"end":{"row":93,"column":8},"action":"remove","lines":["a"]}],[{"start":{"row":93,"column":7},"end":{"row":93,"column":8},"action":"insert","lines":["s"],"id":740},{"start":{"row":93,"column":8},"end":{"row":93,"column":9},"action":"insert","lines":["e"]}],[{"start":{"row":93,"column":9},"end":{"row":93,"column":10},"action":"insert","lines":["A"],"id":741},{"start":{"row":93,"column":10},"end":{"row":93,"column":11},"action":"insert","lines":["l"]},{"start":{"row":93,"column":11},"end":{"row":93,"column":12},"action":"insert","lines":["l"]},{"start":{"row":93,"column":12},"end":{"row":93,"column":13},"action":"insert","lines":["p"]},{"start":{"row":93,"column":13},"end":{"row":93,"column":14},"action":"insert","lines":["o"]},{"start":{"row":93,"column":14},"end":{"row":93,"column":15},"action":"insert","lines":["s"]}],[{"start":{"row":93,"column":15},"end":{"row":93,"column":16},"action":"insert","lines":["i"],"id":742},{"start":{"row":93,"column":16},"end":{"row":93,"column":17},"action":"insert","lines":["t"]},{"start":{"row":93,"column":17},"end":{"row":93,"column":18},"action":"insert","lines":["i"]},{"start":{"row":93,"column":18},"end":{"row":93,"column":19},"action":"insert","lines":["o"]},{"start":{"row":93,"column":19},"end":{"row":93,"column":20},"action":"insert","lines":["n"]}],[{"start":{"row":93,"column":12},"end":{"row":93,"column":13},"action":"remove","lines":["p"],"id":743}],[{"start":{"row":93,"column":12},"end":{"row":93,"column":13},"action":"insert","lines":["P"],"id":744}],[{"start":{"row":93,"column":20},"end":{"row":93,"column":22},"action":"insert","lines":["()"],"id":745}],[{"start":{"row":87,"column":0},"end":{"row":88,"column":22},"action":"remove","lines":["    exchange = Exchange()","    exchange.connect()"],"id":746}],[{"start":{"row":24,"column":53},"end":{"row":25,"column":0},"action":"insert","lines":["",""],"id":747},{"start":{"row":25,"column":0},"end":{"row":26,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":26,"column":0},"end":{"row":27,"column":22},"action":"insert","lines":["    exchange = Exchange()","    exchange.connect()"],"id":748}],[{"start":{"row":26,"column":0},"end":{"row":26,"column":4},"action":"remove","lines":["    "],"id":749}],[{"start":{"row":27,"column":0},"end":{"row":27,"column":4},"action":"remove","lines":["    "],"id":750}],[{"start":{"row":26,"column":1},"end":{"row":26,"column":8},"action":"remove","lines":["xchange"],"id":751}],[{"start":{"row":27,"column":1},"end":{"row":27,"column":8},"action":"remove","lines":["xchange"],"id":752}],[{"start":{"row":107,"column":21},"end":{"row":107,"column":28},"action":"remove","lines":["xchange"],"id":753}],[{"start":{"row":95,"column":4},"end":{"row":95,"column":5},"action":"insert","lines":["#"],"id":754,"ignore":true}],[{"start":{"row":96,"column":4},"end":{"row":97,"column":152},"action":"insert","lines":["response: InsertOrderResponse = e.insert_order(STOCK_INSTRUMENT_IDS[0], price=new_bid, volume=vol, side=SIDE_BID, order_type=ORDER_TYPE_IOC)","            response: InsertOrderResponse = e.insert_order(STOCK_INSTRUMENT_IDS[1], price=new_bid, volume=vol, side=SIDE_BID, order_type=ORDER_TYPE_IOC)"],"id":755,"ignore":true}],[{"start":{"row":97,"column":4},"end":{"row":97,"column":12},"action":"remove","lines":["        "],"id":756,"ignore":true}],[{"start":{"row":91,"column":4},"end":{"row":91,"column":61},"action":"insert","lines":["basket_book = e.get_last_price_book(BASKET_INSTRUMENT_ID)"],"id":757,"ignore":true}],[{"start":{"row":95,"column":23},"end":{"row":97,"column":4},"action":"insert","lines":["","    ","    "],"id":758,"ignore":true}],[{"start":{"row":97,"column":4},"end":{"row":98,"column":49},"action":"insert","lines":["new_bid = basket_book.bids[0].price + 0.1","        new_ask = basket_book.asks[0].price - 0.1"],"id":759,"ignore":true}],[{"start":{"row":98,"column":4},"end":{"row":98,"column":8},"action":"remove","lines":["    "],"id":760,"ignore":true}],[{"start":{"row":97,"column":45},"end":{"row":99,"column":4},"action":"remove","lines":["","    new_ask = basket_book.asks[0].price - 0.1","    "],"id":761,"ignore":true},{"start":{"row":97,"column":45},"end":{"row":98,"column":4},"action":"insert","lines":["","    "]}],[{"start":{"row":58,"column":0},"end":{"row":59,"column":0},"action":"remove","lines":["        if response.success:",""],"id":762,"ignore":true}],[{"start":{"row":57,"column":12},"end":{"row":57,"column":22},"action":"remove","lines":["response: "],"id":763,"ignore":true},{"start":{"row":58,"column":14},"end":{"row":58,"column":22},"action":"remove","lines":["sponse: "]}],[{"start":{"row":58,"column":12},"end":{"row":58,"column":14},"action":"remove","lines":["re"],"id":764,"ignore":true},{"start":{"row":59,"column":12},"end":{"row":59,"column":22},"action":"remove","lines":["response: "]}],[{"start":{"row":57,"column":12},"end":{"row":57,"column":34},"action":"remove","lines":["InsertOrderResponse = "],"id":765,"ignore":true},{"start":{"row":58,"column":12},"end":{"row":58,"column":34},"action":"remove","lines":["InsertOrderResponse = "]}],[{"start":{"row":59,"column":12},"end":{"row":59,"column":34},"action":"remove","lines":["InsertOrderResponse = "],"id":766,"ignore":true}],[{"start":{"row":108,"column":15},"end":{"row":110,"column":8},"action":"remove","lines":["","        trade_cycle(e,vol,bought_prc,sell_prc)","        "],"id":767,"ignore":true},{"start":{"row":108,"column":15},"end":{"row":109,"column":8},"action":"insert","lines":["","        "]}],[{"start":{"row":108,"column":15},"end":{"row":109,"column":8},"action":"insert","lines":["","        "],"id":768,"ignore":true}],[{"start":{"row":109,"column":8},"end":{"row":109,"column":10},"action":"insert","lines":["gf"],"id":769,"ignore":true}],[{"start":{"row":109,"column":8},"end":{"row":109,"column":10},"action":"remove","lines":["gf"],"id":770,"ignore":true}],[{"start":{"row":109,"column":8},"end":{"row":109,"column":75},"action":"insert","lines":["trade_tick_history = exchange.get_trade_tick_history(instrument_id)"],"id":771,"ignore":true}],[{"start":{"row":107,"column":25},"end":{"row":107,"column":26},"action":"remove","lines":["5"],"id":774}],[{"start":{"row":107,"column":25},"end":{"row":107,"column":26},"action":"insert","lines":["1"],"id":775}],[{"start":{"row":109,"column":8},"end":{"row":109,"column":75},"action":"remove","lines":["trade_tick_history = exchange.get_trade_tick_history(instrument_id)"],"id":776}]]},"ace":{"folds":[],"scrolltop":1800,"scrollleft":0,"selection":{"start":{"row":109,"column":8},"end":{"row":109,"column":8},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1684027340292}